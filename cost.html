<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Shipping costs outside T√ºrkiye</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background-color: #f5f5f5; color: #333; }
        .top-container { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; gap: 15px; }
        .language-selector { display: flex; gap: 10px; }
        .language-btn { padding: 8px 15px; background-color: #e63946; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; font-weight: bold; }
        .language-btn.active { background-color: #d62828; box-shadow: inset 0 2px 4px rgba(0,0,0,0.2); }
        .rates-display { background-color: #fff; padding: 10px 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); font-size: 13px; color: #444; border-left: 4px solid #e63946; line-height: 1.5; }
        .rates-display span { font-weight: bold; color: #e63946; }
        .form-container { background-color: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 15px rgba(0,0,0,0.1); }
        h1 { color: #e63946; text-align: center; margin-bottom: 30px; font-size: 28px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; }
        select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px; box-sizing: border-box; }
        #hesapla { width: 100%; padding: 15px; background-color: #e63946; color: white; border: none; border-radius: 5px; font-size: 18px; font-weight: bold; cursor: pointer; transition: background 0.3s; }
        #hesapla:hover { background-color: #d62828; }
        .result-section { margin-top: 25px; padding: 20px; background-color: #f8f9fa; border-radius: 8px; border-left: 5px solid #e63946; display: none; }
        .result-section h3 { margin-top: 0; color: #e63946; text-align: center; font-size: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .currency-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 15px; }
        .currency-box { background: white; padding: 15px 10px; border-radius: 5px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .currency-box h4 { margin: 0 0 10px 0; font-size: 14px; color: #666; }
        .currency-box .price { font-size: 18px; font-weight: bold; color: #333; }
        .loading { display: none; text-align: center; margin-top: 20px; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #e63946; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 0 auto 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .bank-info { margin-top: 30px; padding: 20px; background: #fff; border-radius: 8px; border: 1px solid #eee; display: none; }
        .bank-info table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .bank-info th, .bank-info td { padding: 10px; text-align: left; border-bottom: 1px solid #eee; font-size: 14px; }
        .bank-info th { background: #f9f9f9; width: 35%; }
        .shipping-type { color: #e63946; font-size: 14px; font-weight: bold; margin-left: 5px; }
        @media (max-width: 600px) { .top-container { flex-direction: column; align-items: stretch; } .rates-display { text-align: center; font-size: 12px; } .currency-grid { grid-template-columns: 1fr; } h1 { font-size: 22px; } }
    </style>
</head>
<body>

    <div class="top-container">
        <div class="language-selector">
            <button class="language-btn active" id="tr-btn">TR</button>
            <button class="language-btn" id="en-btn">EN</button>
        </div>
        <div class="rates-display" id="rates-display">
            ‚è≥ Veriler alƒ±nƒ±yor...
        </div>
    </div>

    <div class="form-container">
        <h1 id="page-title">T√ºrkiye Dƒ±≈üƒ± Kargo √úcretleri</h1>
        
        <div class="form-group">
            <label for="model" id="model-label">Model Se√ßin:</label>
            <select id="model">
                <option value="standart" data-tr="Standart Mangal" data-en="Standard Grill">Standart Mangal</option>
                <option value="aparatli" data-tr="≈ûi≈ü Kebap Aparatlƒ±" data-en="With Shish Kebab Apparatus">≈ûi≈ü Kebap Aparatlƒ±</option>
            </select>
        </div>

        <div class="form-group">
            <label for="ulke" id="country-label">√úlke Se√ßin:</label>
            <select id="ulke">
                <option value="">-- √úlke Y√ºkleniyor --</option>
            </select>
        </div>
        
        <button id="hesapla" data-tr="Hesapla" data-en="Calculate">Hesapla</button>
        
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p id="calculating-text">Hesaplanƒ±yor...</p>
        </div>

        <div id="sonuc" class="result-section">
            <h3 id="sonuc-title">Kargo √úcreti</h3>
            <div class="currency-grid">
                <div class="currency-box"><h4 id="tl-title">TRY</h4><div class="price" id="tl_sonuc"></div></div>
                <div class="currency-box"><h4 id="eur-title">EUR</h4><div class="price" id="eur_sonuc"></div></div>
                <div class="currency-box"><h4 id="usd-title">USD</h4><div class="price" id="usd_sonuc"></div></div>
            </div>
        </div>

        <div id="product-info" class="result-section">
            <h3 id="product-info-title">√úr√ºn Fiyatƒ±</h3>
            <div class="currency-grid">
                <div class="currency-box"><h4 id="product-tl-title">TRY</h4><div class="price" id="product_tl"></div></div>
                <div class="currency-box"><h4 id="product-eur-title">EUR</h4><div class="price" id="product_eur"></div></div>
                <div class="currency-box"><h4 id="product-usd-title">USD</h4><div class="price" id="product_usd"></div></div>
            </div>
        </div>

        <div id="total-info" class="result-section">
            <h3 id="total-info-title">Toplam √ñdenecek Tutar</h3>
            <div class="currency-grid">
                <div class="currency-box"><h4 id="total-tl-title">TRY</h4><div class="price" id="total_tl"></div></div>
                <div class="currency-box"><h4 id="total-eur-title">EUR</h4><div class="price" id="total_eur"></div></div>
                <div class="currency-box"><h4 id="total-usd-title">USD</h4><div class="price" id="total_usd"></div></div>
            </div>
        </div>

        <div id="bank-info" class="bank-info">
            <h3 id="bank-info-title">Banka Hesap Bilgileri</h3>
            <table>
                <tr><th id="bank-label">Banka</th><td>YAPI VE KREDI BANKASI A.S.</td></tr>
                <tr><th id="swift-label">Swift</th><td>YAPITRISXXX</td></tr>
                <tr><th id="account-name-label">Hesap Adƒ±</th><td>√áETƒ∞N √ñREN</td></tr>
                <tr><th id="try-iban-label">TRY IBAN</th><td>TR02 0006 7010 0000 0024 3989 57</td></tr>
                <tr><th id="usd-iban-label">USD IBAN</th><td>TR46 0006 7010 0000 0015 0696 75</td></tr>
                <tr><th id="eur-iban-label">EUR IBAN</th><td>TR14 0006 7010 0000 0015 0704 45</td></tr>
            </table>
        </div>
    </div>

    <script>
        const translations = {
            tr: {
                "page-title": "T√ºrkiye Dƒ±≈üƒ± Kargo √úcretleri", "model-label": "√úr√ºn Se√ßin:", "country-label": "√úlke Se√ßin:",
                "hesapla": "Hesapla", "calculating-text": "Hesaplanƒ±yor...", "tl-title": "T√ºrk Lirasƒ± (TL)", "eur-title": "Euro (EUR)",
                "usd-title": "ABD Dolarƒ± (USD)", "bank-info-title": "Banka Hesap Bilgileri", "bank-label": "Banka",
                "swift-label": "Swift", "account-name-label": "Hesap Adƒ±", "try-iban-label": "TRY IBAN", "usd-iban-label": "USD IBAN",
                "eur-iban-label": "EUR IBAN", "select-country": "-- √úlke Se√ßin --", "sonuc-title": "Kargo √úcreti",
                "product-info-title": "√úr√ºn Fiyatƒ±", "total-info-title": "Toplam √ñdenecek Tutar",
                "product-tl-title": "T√ºrk Lirasƒ± (TL)", "product-eur-title": "Euro (EUR)", "product-usd-title": "ABD Dolarƒ± (USD)",
                "total-tl-title": "T√ºrk Lirasƒ± (TL)", "total-eur-title": "Euro (EUR)", "total-usd-title": "ABD Dolarƒ± (USD)"
            },
            en: {
                "page-title": "International Shipping Costs", "model-label": "Choose Product:", "country-label": "Select Country:",
                "hesapla": "Calculate", "calculating-text": "Calculating...", "tl-title": "Turkish Lira (TL)", "eur-title": "Euro (EUR)",
                "usd-title": "US Dollar (USD)", "bank-info-title": "Bank Account Information", "bank-label": "Bank",
                "swift-label": "Swift", "account-name-label": "Account Name", "try-iban-label": "TRY IBAN", "usd-iban-label": "USD IBAN",
                "eur-iban-label": "EUR IBAN", "select-country": "-- Select Country --", "sonuc-title": "Shipping Price",
                "product-info-title": "Product Price", "total-info-title": "Total Amount to Pay",
                "product-tl-title": "Turkish Lira (TL)", "product-eur-title": "Euro (EUR)", "product-usd-title": "US Dollar (USD)",
                "total-tl-title": "Turkish Lira (TL)", "total-eur-title": "Euro (EUR)", "total-usd-title": "US Dollar (USD)"
            }
        };

        const modelConfig = { standart: { price: 9000, weight: 11 }, aparatli: { price: 10500, weight: 13 } };
        
        let ulkeFiyatlariDinamic = {};
        let countryTranslationsEN = {};
        window.currentRates = null;
        
        const hesaplaBtn = document.getElementById('hesapla');

        async function getExchangeRates() {
            try {
                const response = await fetch('/api/rates');
                const rates = await response.json();
                if (!rates.SDR) rates.SDR = 60.31; 
                return rates;
            } catch (error) {
                return { USD: 43.94, EUR: 51.88, SDR: 60.31, Tarih: "Sabit Kur" };
            }
        }

        async function getCountryData() {
            try {
                const [priceRes, transRes] = await Promise.all([
                    fetch('ulkeFiyatlari.json'),
                    fetch('countryTranslations.json')
                ]);
                ulkeFiyatlariDinamic = await priceRes.json();
                countryTranslationsEN = await transRes.json();
            } catch (error) {
                console.error("Veri dosyalarƒ± y√ºklenemedi", error);
                document.getElementById('ulke').innerHTML = `<option value="">‚ö†Ô∏è Veri Y√ºklenemedi</option>`;
            }
        }

        function populateDropdown(lang) {
            const select = document.getElementById('ulke');
            const currentVal = select.value;
            select.innerHTML = `<option value="">${translations[lang]['select-country']}</option>`;
            
            // 1. √úlkeleri orjinal kodu ve g√∂sterilecek ismiyle objeye √ßevir
            let ulkeListesi = Object.keys(ulkeFiyatlariDinamic).map(ulkeKod => {
                let displayKisim = ulkeKod.toLocaleUpperCase('tr-TR'); 

                if (lang === 'en' && countryTranslationsEN[displayKisim]) {
                    displayKisim = countryTranslationsEN[displayKisim];
                }

                return {
                    orjinalKod: ulkeKod,
                    ekrandaGorunen: displayKisim
                };
            });

            // 2. Dile g√∂re doƒüru alfabetik sƒ±ralama yap (≈û, √á, ƒ∞ dahil)
            ulkeListesi.sort((a, b) => {
                if (lang === 'tr') {
                    return a.ekrandaGorunen.localeCompare(b.ekrandaGorunen, 'tr-TR');
                } else {
                    return a.ekrandaGorunen.localeCompare(b.ekrandaGorunen, 'en-US');
                }
            });

            // 3. Sƒ±ralanmƒ±≈ü listeyi ekrana bas
            ulkeListesi.forEach(ulke => {
                const opt = document.createElement('option');
                opt.value = ulke.orjinalKod; 
                opt.textContent = ulke.ekrandaGorunen;
                select.appendChild(opt);
            });
            
            select.value = currentVal;
        }

        function changeLanguage(lang) {
            Object.keys(translations[lang]).forEach(id => {
                const el = document.getElementById(id);
                if (el) el.innerHTML = translations[lang][id];
            });
            const modelSelect = document.getElementById('model');
            Array.from(modelSelect.options).forEach(opt => { opt.textContent = opt.getAttribute(`data-${lang}`); });
            document.querySelectorAll('.language-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`${lang}-btn`).classList.add('active');
            
            if(Object.keys(ulkeFiyatlariDinamic).length > 0) populateDropdown(lang);
        }

        document.getElementById('tr-btn').onclick = () => changeLanguage('tr');
        document.getElementById('en-btn').onclick = () => changeLanguage('en');

        window.onload = async () => {
            // G√ºvenlik: Veriler inene kadar butonu kilitle
            hesaplaBtn.disabled = true;
            hesaplaBtn.style.opacity = '0.5';
            hesaplaBtn.style.cursor = 'not-allowed';

            const [rates] = await Promise.all([
                getExchangeRates(), 
                getCountryData()
            ]);
            
            window.currentRates = rates;
            changeLanguage('tr'); 
            
            document.getElementById('rates-display').innerHTML = `
                üìÖ ${rates.Tarih} <br>
                <span>USD: ${rates.USD.toFixed(2)} ‚Ç∫</span> | 
                <span>EUR: ${rates.EUR.toFixed(2)} ‚Ç∫</span> | 
                <span>SDR: ${rates.SDR.toFixed(2)} ‚Ç∫</span>
            `;

            // Veriler ba≈üarƒ±yla indiyse butonu aktif et
            if (Object.keys(ulkeFiyatlariDinamic).length > 0) {
                hesaplaBtn.disabled = false;
                hesaplaBtn.style.opacity = '1';
                hesaplaBtn.style.cursor = 'pointer';
            }
        };

        const roundTL = (n) => Math.ceil(n / 10) * 10;
        const roundCUR = (n) => Math.ceil(n);

        // Parayƒ± 10.500 ‚Ç∫ ≈üeklinde ayra√ßlƒ± formatlar
        const formatMoney = (amount) => {
            return new Intl.NumberFormat('tr-TR').format(amount);
        };

        hesaplaBtn.onclick = async function() {
            const ulkeKod = document.getElementById('ulke').value;
            const model = modelConfig[document.getElementById('model').value];
            
            if (!ulkeKod || !ulkeFiyatlariDinamic[ulkeKod]) { 
                alert(document.getElementById('tr-btn').classList.contains('active') ? 'L√ºtfen bir √ºlke se√ßin!' : 'Please select a country!'); 
                return; 
            }

            document.getElementById('loading').style.display = 'block';
            ['sonuc', 'product-info', 'total-info', 'bank-info'].forEach(id => document.getElementById(id).style.display = 'none');

            const rates = window.currentRates;
            const countryData = ulkeFiyatlariDinamic[ulkeKod];

            let selectedShipping = null;
            let typeMarker = "";

            if (countryData.ucak && countryData.ucak.ilk) {
                selectedShipping = countryData.ucak;
                typeMarker = "(U)";
            } else if (countryData.yuzey && countryData.yuzey.ilk) {
                selectedShipping = countryData.yuzey;
                typeMarker = "(Y)";
            }

            if (!selectedShipping) {
                alert("Kargo verisi bulunamadƒ±!");
                document.getElementById('loading').style.display = 'none';
                return;
            }

            const sdrToplam = selectedShipping.ilk + ((model.weight - 1) * selectedShipping.ek);
            const tlKargo = roundTL(sdrToplam * rates.SDR);
            const eurKargo = roundCUR(tlKargo / rates.EUR);
            const usdKargo = roundCUR(tlKargo / rates.USD);

            const urunTL = model.price;
            const urunEUR = roundCUR(urunTL / rates.EUR);
            const urunUSD = roundCUR(urunTL / rates.USD);

            const isTr = document.getElementById('tr-btn').classList.contains('active');
            document.getElementById('sonuc-title').innerHTML = `${isTr ? "Kargo √úcreti" : "Shipping Price"} <span class="shipping-type">${typeMarker}</span>`;

            // Formatlanmƒ±≈ü Paralarƒ± Yazdƒ±r
            document.getElementById('tl_sonuc').innerText = formatMoney(tlKargo) + " ‚Ç∫";
            document.getElementById('eur_sonuc').innerText = formatMoney(eurKargo) + " ‚Ç¨";
            document.getElementById('usd_sonuc').innerText = formatMoney(usdKargo) + " $";

            document.getElementById('product_tl').innerText = formatMoney(urunTL) + " ‚Ç∫";
            document.getElementById('product_eur').innerText = formatMoney(urunEUR) + " ‚Ç¨";
            document.getElementById('product_usd').innerText = formatMoney(urunUSD) + " $";

            document.getElementById('total_tl').innerText = formatMoney(tlKargo + urunTL) + " ‚Ç∫";
            document.getElementById('total_eur').innerText = formatMoney(eurKargo + urunEUR) + " ‚Ç¨";
            document.getElementById('total_usd').innerText = formatMoney(usdKargo + urunUSD) + " $";

            // Y√ºkleme animasyonu ve sonu√ßlarƒ± g√∂sterme efekti
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
                ['sonuc', 'product-info', 'total-info', 'bank-info'].forEach(id => document.getElementById(id).style.display = 'block');
            }, 300);
        };
    </script>
</body>
</html>
